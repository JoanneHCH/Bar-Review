<h2 class="mb-3 text-primary fw-bold"><%= bar.name %></h2>

<!-- Basic Info -->
<div class="mb-3">
  <p><strong>â­ Rating:</strong>
  <% if (bar.rating) { %>
    <% for (let i = 1; i <= 5; i++) { %>
      <% if (i <= bar.rating) { %>
        <span style="color: gold;">â˜…</span>
      <% } else { %>
        <span style="color: #ccc;">â˜…</span>
      <% } %>
    <% } %>
    <span class="text-muted">ï¼ˆ<%= bar.rating %> / 5ï¼‰</span>
  <% } else { %>
    Not yet rated
  <% } %>
</p>
  <p><strong>ğŸ“ Description:</strong> <%= bar.description || 'No description yet' %></p>

<!-- Images -->
<p><strong>ğŸ“¸ Images:</strong></p>

<% if (bar.images && bar.images.length > 0) { %>
  <div class="row">
    <% bar.images.forEach(img => { %>
      <div class="col-md-4 col-6 text-center mb-4">
        <img src="<%= img.url %>"
             alt="Bar image"
             class="img-fluid rounded shadow-sm"
             style="max-height: 250px; object-fit: cover;">
      </div>
    <% }) %>
  </div>
<% } else { %>
  <p class="text-muted">No images uploaded yet</p>
<% } %> 
  <p><strong>ğŸ“ Location:</strong> <%= bar.location || 'Not provided' %></p>

</div>

<div id="map" style="width: 100%; height: 400px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"></div>

<!-- Google Maps JS -->
<script
  src="https://maps.googleapis.com/maps/api/js?key=<%= GOOGLE_MAPS_API_KEY %>&callback=initMap"
  async
  defer>
</script>

<script>
  function initMap() {
    // Make sure coordinates are valid numeric values
    const lat = Number("<%= bar.latitude || '' %>");
    const lng = Number("<%= bar.longitude || '' %>");
    const hasCoords = !isNaN(lat) && !isNaN(lng);

    // Default to Taipei City Hall if no coordinates
    const barLocation = hasCoords ? { lat, lng } : { lat: 25.0375, lng: 121.5637 };

    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: hasCoords ? 15 : 12,
      center: barLocation,
    });

    // Place marker only if valid coordinates exist
    if (hasCoords) {
      const marker = new google.maps.Marker({
        position: barLocation,
        map: map,
        title: "<%= bar.name %>"
      });

      const infoWindow = new google.maps.InfoWindow({
        content: `
          <div style="text-align:center;">
            <strong><%= bar.name %></strong><br>
            <%= bar.location || '' %>
          </div>`
      });

      marker.addListener("click", () => infoWindow.open(map, marker));
    } else {
      // Show a message when no coordinates are available
      const infoDiv = document.createElement("div");
      infoDiv.innerHTML = "<p class='text-muted'>No coordinates provided, so the map shows the default location (Taipei City Hall)</p>";
      document.getElementById("map").after(infoDiv);
    }
  }
</script>

<!-- Action Buttons -->
<div class="mt-4 d-flex flex-wrap justify-content-between align-items-center">
  <!-- Left: Edit + Back -->
  <div class="d-flex gap-2">
    <a href="/bars/<%= bar._id %>/edit" class="btn btn-secondary">âœï¸ Edit</a>
    <a href="/bars" class="btn btn-secondary">Back to List</a>
  </div>

  <!-- Right: Delete -->
  <form action="/bars/<%= bar._id %>?_method=DELETE" method="POST"
      onsubmit="return confirm('âš ï¸ Are you sure you want to delete this bar? This will also delete all images.');">
    <button type="submit" class="btn btn-danger">ğŸ—‘ï¸ Delete Bar</button>
  </form>

</div>